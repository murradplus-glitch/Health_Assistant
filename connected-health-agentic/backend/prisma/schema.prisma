generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                 Int       @id @default(autoincrement())
  name               String
  phone              String?
  cnic               String?
  role               String
  languagePreference String    @map("language_preference")
  district           String?
  tehsil             String?
  patients           Patient[]
  interactions       Interaction[]
  createdAt          DateTime  @default(now()) @map("created_at")
}

model Patient {
  id               Int                 @id @default(autoincrement())
  user             User?               @relation(fields: [userId], references: [id])
  userId           Int?                @map("user_id")
  fullName         String              @map("full_name")
  age              Int
  gender           String
  pregnancyStatus  String?             @map("pregnancy_status")
  address          String?
  lat              Float?
  lng              Float?
  programs         PatientProgramEligibility[]
  reminders        Reminder[]
  interactions     Interaction[]
}

model Facility {
  id            Int              @id @default(autoincrement())
  name          String
  type          String
  district      String
  tehsil        String
  lat           Float?
  lng           Float?
  services      Json
  openingHours  Json              @map("opening_hours")
  contact       String?
  inventory     FacilityInventory[]

  @@index([district, tehsil])
}

model FacilityInventory {
  id         Int      @id @default(autoincrement())
  facility   Facility @relation(fields: [facilityId], references: [id])
  facilityId Int      @map("facility_id")
  itemName   String   @map("item_name")
  itemType   String   @map("item_type")
  stockLevel String   @map("stock_level")
  lastUpdated DateTime @map("last_updated")
}

model Program {
  id              Int      @id @default(autoincrement())
  name            String
  description     String
  eligibilityRules Json    @map("eligibility_rules")
  patientEligibility PatientProgramEligibility[]
}

model PatientProgramEligibility {
  id        Int      @id @default(autoincrement())
  patient   Patient  @relation(fields: [patientId], references: [id])
  patientId Int      @map("patient_id")
  program   Program  @relation(fields: [programId], references: [id])
  programId Int      @map("program_id")
  status    String
  details   Json
}

model Interaction {
  id            Int       @id @default(autoincrement())
  user          User?     @relation(fields: [userId], references: [id])
  userId        Int?      @map("user_id")
  patient       Patient?  @relation(fields: [patientId], references: [id])
  patientId     Int?      @map("patient_id")
  agentName     String    @map("agent_name")
  inputSummary  String    @map("input_summary")
  outputSummary String    @map("output_summary")
  triageLevel   String?   @map("triage_level")
  createdAt     DateTime  @default(now()) @map("created_at")

  @@index([createdAt])
}

model Reminder {
  id          Int       @id @default(autoincrement())
  patient     Patient   @relation(fields: [patientId], references: [id])
  patientId   Int       @map("patient_id")
  type        String
  message     String
  scheduledAt DateTime  @map("scheduled_at")
  status      String
}

model AnalyticsEvent {
  id        Int      @id @default(autoincrement())
  eventType String   @map("event_type")
  payload   Json
  createdAt DateTime @default(now()) @map("created_at")

  @@index([createdAt])
}

model McpLog {
  id        Int      @id @default(autoincrement())
  toolName  String   @map("tool_name")
  input     Json
  output    Json?
  error     String?
  createdAt DateTime @default(now()) @map("created_at")
}
